{% load static %}
<!DOCTYPE html>
<html lang="es" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Pilates Reforma{% endblock %}</title>

    <!-- Favicon -->
    <link rel="icon" href="{% static 'favicon.ico' %}" />

    <!-- Vendor -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <script src="https://code.iconify.design/3/3.1.0/iconify.min.js"></script>

    <!-- CSS estáticos -->
    <link rel="stylesheet" href="{% static 'css/chatbot.css' %}?v=5" />
    <link rel="stylesheet" href="{% static 'css/site.css' %}?v=41" />
    <!-- Sube solo este número cuando pegues nuevos estilos para forzar recarga -->
    <link rel="stylesheet" href="{% static 'css/navbar.css' %}?v=52" />
  </head>

  <body class="d-flex flex-column min-vh-100 chat-theme--glass nav-style--dock">
    <!-- CSRF token accesible para JS -->
    <div id="csrf-token" style="display: none">{% csrf_token %}</div>

    <!-- TOP BAR -->
    <!-- TOP BAR (rediseñado) -->
    <!-- TOP BAR — Aura / Glass + Glow -->
    <div class="tb-aura">
      <div class="container tb-flex">
        <!-- Marca -->
        <a href="/" class="tb-brand" aria-label="Pilates Reforma">
          <span class="tb-badge"><i class="bi bi-heart-pulse-fill"></i></span>
          <span class="tb-title">
            <span class="tb-name-1l">Pilates <span>Reforma</span></span>
          </span>
        </a>

        <!-- Acciones -->
        <nav class="tb-chips">
          <a class="tb-pill" href="#mapa" aria-label="Ver ubicación">
            <i class="bi bi-geo-alt-fill"></i><span>Peñalolén · Santiago</span>
          </a>
          <a class="tb-pill" href="tel:+56912345678" aria-label="Llamar">
            <i class="bi bi-telephone-fill"></i><span>+56 9 1234 5678</span>
          </a>
          <a
            class="tb-pill"
            href="mailto:contacto@pilatesreserva.cl"
            aria-label="Enviar correo"
          >
            <i class="bi bi-envelope-fill"></i
            ><span>contacto@pilatesreserva.cl</span>
          </a>
        </nav>
      </div>
    </div>

    {% with current=request.resolver_match.url_name|default:"" %}
    <div class="hr-accent"></div>

    <!-- Navbar principal -->
    <!-- IMPORTANTE: mantenemos id="navbar" como gancho CSS estable -->
    <nav
      id="navbar"
      class="navbar navbar-expand-lg sticky-top border-0 py-3 nav--glass"
    >
      <div class="container justify-content-center">
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNavGlass"
          aria-controls="navbarNavGlass"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div
          class="collapse navbar-collapse justify-content-center"
          id="navbarNavGlass"
        >
          <ul class="navbar-nav align-items-center gap-2">
            <li class="nav-item">
              <a
                class="nav-link pr-pill fw-semibold px-4 py-2 {% if current == 'index' %}active{% endif %}"
                href="{% url 'index:index' %}"
              >
                <i class="bi bi-house-door me-1"></i>Inicio
              </a>
            </li>

            <li class="nav-item">
              <a
                class="nav-link pr-pill fw-semibold px-4 py-2 {% if current == 'contacto_publico' %}active{% endif %}"
                href="{% url 'index:contacto_publico' %}"
              >
                <i class="bi bi-chat-dots me-1"></i>Contacto
              </a>
            </li>

            <li class="nav-item">
              <a
                class="nav-link {% if request.resolver_match.url_name == 'faqs' %}active{% endif %}"
                href="{% url 'index:faqs' %}"
              >
                <i class="bi bi-question-circle me-1"></i> FAQs
              </a>
            </li>

            <li class="nav-item">
              <a
                class="nav-link {% if request.resolver_match.url_name == 'novedades' %}active{% endif %}"
                href="{% url 'index:novedades' %}"
              >
                <i class="bi bi-broadcast me-1"></i> Novedades
              </a>
            </li>

            <li class="nav-item">
              <a
                class="nav-link pr-pill fw-semibold px-4 py-2 {% if current == 'clases' %}active{% endif %}"
                href="{% url 'index:clases' %}"
              >
                <i class="bi bi-grid-3x3-gap me-1"></i>Clases
              </a>
            </li>

            <li class="nav-item">
              <a
                class="nav-link pr-pill fw-semibold px-4 py-2 {% if current == 'login' %}active{% endif %}"
                href="{% url 'login:login' %}"
              >
                <i class="bi bi-box-arrow-in-right me-1"></i>Login
              </a>
            </li>
          </ul>

          <div class="ms-lg-3 mt-3 mt-lg-0">
            <button
              class="btn btn-outline-secondary d-inline-flex align-items-center"
              id="themeToggle"
              type="button"
              aria-label="Cambiar tema"
            >
              <i id="themeIcon" class="bi bi-moon-stars"></i>
            </button>
          </div>
        </div>
      </div>
    </nav>
    {% endwith %}

    <!-- TRUST BAR -->
    {% if request.resolver_match.url_name|default:'' == 'index' %}
    <div class="lp-trustbar py-2">
      <div class="container d-flex flex-wrap gap-3 justify-content-center small">
        <div class="d-flex align-items-center gap-2">
          <i class="bi bi-bag-check"></i> Reserva fácil
        </div>
        <div class="d-flex align-items-center gap-2">
          <i class="bi bi-people"></i> Grupos pequeños
        </div>
        <div class="d-flex align-items-center gap-2">
          <i class="bi bi-award"></i> Certificaciones internacionales
        </div>
        <div class="d-flex align-items-center gap-2">
          <i class="bi bi-shield-plus"></i> Medidas higiénicas
        </div>
      </div>
    </div>
    {% endif %}

    <!-- Contenido dinámico -->
    {% block content %}{% endblock %}

    <!-- ======== BLOQUES EXTRA HOME ======== -->
    {% if request.resolver_match.url_name|default:'' == 'index' %}
    <!-- Galería -->
    <section class="container my-5 lp-reveal">
      <div class="gallery-shell lp-gallery">
        <div
          id="studioCarousel"
          class="carousel slide"
          data-bs-ride="carousel"
          data-bs-interval="5000"
        >
          <div class="carousel-inner">
            <div class="carousel-item active">
              <img
                class="lp-cover"
                src="https://vibepilates.com.au/wp-content/uploads/2023/04/Reformer-Pilates-Flexibility-Range-of-Motion.jpg"
                alt="Pilates Reformer 1 — Ahmet Kurt / Pexels"
              />
            </div>
            <div class="carousel-item">
              <img
                class="lp-cover"
                src="https://images.squarespace-cdn.com/content/v1/61b145b04b4aaf6e35670707/0f19ba6e-ac19-4af9-bd33-4cb6ac38b532/reformerpilatesstudioadelaide.jpg"
                alt="Pilates Reformer 2 — Ahmet Kurt / Pexels"
              />
            </div>
            <div class="carousel-item">
              <img
                class="lp-cover"
                src="https://cdn.shopify.com/s/files/1/0707/5024/1075/articles/Pilates_Reformers_Australia_1500_265.jpg?v=1686269956"
                alt="Pilates Reformer 3 — Ahmet Kurt / Pexels"
              />
            </div>
            <div class="carousel-item">
              <img
                class="lp-cover"
                src="https://img.edilportale.com/products/Balanced-Body_PILATES-ALLEGRO-2-REFORMER_9vwTsGQ3DR.jpeg"
                alt="Pilates Reformer 4 — Ahmet Kurt / Pexels"
              />
            </div>
            <div class="carousel-item">
              <img
                class="lp-cover"
                src="https://semprose.com.au/wp-content/uploads/2023/03/Pilates-Reformers-Australia-1500-191.jpg"
                alt="Pilates Reformer 5 — Ahmet Kurt / Pexels"
              />
            </div>
          </div>

          <button
            class="carousel-control-prev"
            type="button"
            data-bs-target="#studioCarousel"
            data-bs-slide="prev"
          >
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Anterior</span>
          </button>
          <button
            class="carousel-control-next"
            type="button"
            data-bs-target="#studioCarousel"
            data-bs-slide="next"
          >
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visualmente-hidden">Siguiente</span>
          </button>
        </div>
      </div>
    </section>

    <!-- Programas -->
    <section class="container my-5 lp-reveal">
      <div class="text-center mb-4">
        <h3 class="fw-bold">Programas y beneficios</h3>
        <p class="text-muted m-0">
          Planes que se adaptan a tu nivel y objetivos.
        </p>
      </div>
      <div class="row g-4">
        <div class="col-12 col-md-4">
          <div class="card-glass h-100 p-4">
            <div
              class="d-inline-flex align-items-center justify-content-center rounded-circle icon-bubble-30"
              style="background: var(--lp-soft); width: 50px; height: 50px"
            >
              <i class="bi bi-person-arms-up" style="color: var(--lp-accent-1)"></i>
            </div>
            <h5 class="fw-bold mt-3">Mat Pilates</h5>
            <p class="text-muted mb-0">
              Fortalece tu centro, mejora postura y flexibilidad.
            </p>
          </div>
        </div>
        <div class="col-12 col-md-4">
          <div class="card-glass h-100 p-4">
            <div
              class="d-inline-flex align-items-center justify-content-center rounded-circle icon-bubble-30"
              style="background: var(--lp-soft); width: 50px; height: 50px"
            >
              <i class="bi bi-columns-gap" style="color: var(--lp-accent-2)"></i>
            </div>
            <h5 class="fw-bold mt-3">Reformer</h5>
            <p class="text-muted mb-0">
              Trabajo en máquina para precisión y seguridad.
            </p>
          </div>
        </div>
        <div class="col-12 col-md-4">
          <div class="card-glass h-100 p-4">
            <div
              class="d-inline-flex align-items-center justify-content-center rounded-circle icon-bubble-30"
              style="background: var(--lp-soft); width: 50px; height: 50px"
            >
              <i class="bi bi-people-fill" style="color: #22c55e"></i>
            </div>
            <h5 class="fw-bold mt-3">Grupales</h5>
            <p class="text-muted mb-0">
              Motivación en grupo con seguimiento cercano.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Instructores (NUEVO layout .inst-grid + .inst-card.neo) -->
    <section class="container my-5 lp-reveal">
      <div class="text-center mb-4">
        <h3 class="fw-bold">Conoce a nuestros instructores</h3>
        <p class="text-muted m-0">
          Haz clic en cada perfil para ver detalles y horarios.
        </p>
      </div>

      <div class="inst-grid">
        <!-- Camila -->
        <article
          class="inst-card neo"
          role="button"
          tabindex="0"
          data-bs-toggle="modal"
          data-bs-target="#instCamila"
          aria-label="Ver perfil de Camila Torres"
        >
          <div class="inst-avatar-wrap">
            <img
              class="inst-avatar"
              src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=400&auto=format&fit=crop"
              alt="Camila Torres"
            />
          </div>
          <h3 class="inst-name">Camila Torres</h3>
          <div class="inst-roles">Reformer · Mat</div>

          <div class="inst-tags">
            <span class="chip">ISSA</span>
            <span class="chip">Pilates INT</span>
          </div>

          <div class="inst-spacer"></div>

          <div class="inst-cta">
            <span class="text-muted small">Haz clic para ver detalles</span>
          </div>
        </article>

        <!-- Javier -->
        <article
          class="inst-card neo"
          role="button"
          tabindex="0"
          data-bs-toggle="modal"
          data-bs-target="#instJavier"
          aria-label="Ver perfil de Javier Rivas"
        >
          <div class="inst-avatar-wrap">
            <img
              class="inst-avatar"
              src="https://images.unsplash.com/photo-1547425260-76bcadfb4f2c?q=80&w=400&auto=format&fit=crop"
              alt="Javier Rivas"
            />
          </div>
          <h3 class="inst-name">Javier Rivas</h3>
          <div class="inst-roles">Fuerza · Movilidad</div>

          <div class="inst-tags">
            <span class="chip">ANP</span>
            <span class="chip">Mobility</span>
          </div>

          <div class="inst-spacer"></div>

          <div class="inst-cta">
            <span class="text-muted small">Haz clic para ver detalles</span>
          </div>
        </article>

        <!-- Valeria -->
        <article
          class="inst-card neo"
          role="button"
          tabindex="0"
          data-bs-toggle="modal"
          data-bs-target="#instValeria"
          aria-label="Ver perfil de Valeria Núñez"
        >
          <div class="inst-avatar-wrap">
            <img
              class="inst-avatar"
              src="https://images.unsplash.com/photo-1554151228-14d9def656e4?q=80&w=400&auto=format&fit=crop"
              alt="Valeria Núñez"
            />
          </div>
          <h3 class="inst-name">Valeria Núñez</h3>
          <div class="inst-roles">Postura · Core</div>

          <div class="inst-tags">
            <span class="chip">Mat Pro</span>
            <span class="chip">Reformer</span>
          </div>

          <div class="inst-spacer"></div>

          <div class="inst-cta">
            <span class="text-muted small">Haz clic para ver detalles</span>
          </div>
        </article>

        <!-- Tomás -->
        <article
          class="inst-card neo"
          role="button"
          tabindex="0"
          data-bs-toggle="modal"
          data-bs-target="#instTomas"
          aria-label="Ver perfil de Tomás Silva"
        >
          <div class="inst-avatar-wrap">
            <img
              class="inst-avatar"
              src="https://images.unsplash.com/photo-1547106634-56dcd53ae883?q=80&w=400&auto=format&fit=crop"
              alt="Tomás Silva"
            />
          </div>
          <h3 class="inst-name">Tomás Silva</h3>
          <div class="inst-roles">Grupal · Rendimiento</div>

          <div class="inst-tags">
            <span class="chip">HIIT</span>
            <span class="chip">Funcional</span>
          </div>

          <div class="inst-spacer"></div>

          <div class="inst-cta">
            <span class="text-muted small">Haz clic para ver detalles</span>
          </div>
        </article>
      </div>

      <!-- Modales -->
      <div class="modal fade" id="instCamila" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content glass inst-modal">
            <div class="modal-header">
              <h5 class="modal-title">Camila Torres</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Cerrar"
              ></button>
            </div>

            <!-- NUEVO: hero + foto -->
            <div class="im-hero">
              <div class="im-avatar-wrap">
                <img
                  class="im-avatar"
                  src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=400&auto=format&fit=crop"
                  alt="Camila Torres"
                />
              </div>
            </div>

            <div class="modal-body im-body">
              <p>
                Especialista en técnica, prevención de lesiones y corrección
                postural.
              </p>
              <ul class="text-muted small">
                <li>Certificaciones: ISSA, Pilates International</li>
                <li>Modalidades: Reformer · Mat</li>
                <li>Enfoque: postura, respiración, control</li>
              </ul>
              <a
                class="btn btn-gradient w-100"
                href="{% url 'index:clases' %}?instructor=Camila%20Torres"
                ><i class="bi bi-calendar-event me-1"></i> Ver horarios</a
              >
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="instJavier" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content glass inst-modal">
            <div class="modal-header">
              <h5 class="modal-title">Javier Rivas</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Cerrar"
              ></button>
            </div>

            <!-- NUEVO: hero + foto -->
            <div class="im-hero">
              <div class="im-avatar-wrap">
                <img
                  class="im-avatar"
                  src="https://images.unsplash.com/photo-1547425260-76bcadfb4f2c?q=80&w=400&auto=format&fit=crop"
                  alt="Javier Rivas"
                />
              </div>
            </div>

            <div class="modal-body im-body">
              <p>
                Trabajo funcional, movilidad y progresiones seguras para todos
                los niveles.
              </p>
              <ul class="text-muted small">
                <li>Certificaciones: ANP, Mobility</li>
                <li>Modalidades: Fuerza · Movilidad</li>
                <li>Enfoque: consciencia corporal, fluidez</li>
              </ul>
              <a
                class="btn btn-gradient w-100"
                href="{% url 'index:clases' %}?instructor=Javier%20Rivas"
                ><i class="bi bi-calendar-event me-1"></i> Ver horarios</a
              >
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="instValeria" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content glass inst-modal">
            <div class="modal-header">
              <h5 class="modal-title">Valeria Núñez</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Cerrar"
              ></button>
            </div>

            <!-- NUEVO: hero + foto -->
            <div class="im-hero">
              <div class="im-avatar-wrap">
                <img
                  class="im-avatar"
                  src="https://images.unsplash.com/photo-1554151228-14d9def656e4?q=80&w=400&auto=format&fit=crop"
                  alt="Valeria Núñez"
                />
              </div>
            </div>

            <div class="modal-body im-body">
              <p>
                Corrección postural y fortalecimiento del core con foco en
                control y precisión.
              </p>
              <ul class="text-muted small">
                <li>Certificaciones: Mat Pro, Reformer</li>
                <li>Modalidades: Postura · Core</li>
                <li>Enfoque: estabilidad lumbopélvica</li>
              </ul>
              <a
                class="btn btn-gradient w-100"
                href="{% url 'index:clases' %}?instructor=Valeria%20Núñez"
                ><i class="bi bi-calendar-event me-1"></i> Ver horarios</a
              >
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="instTomas" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content glass inst-modal">
            <div class="modal-header">
              <h5 class="modal-title">Tomás Silva</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Cerrar"
              ></button>
            </div>

            <!-- NUEVO: hero + foto -->
            <div class="im-hero">
              <div class="im-avatar-wrap">
                <img
                  class="im-avatar"
                  src="https://images.unsplash.com/photo-1547106634-56dcd53ae883?q=80&w=400&auto=format&fit=crop"
                  alt="Tomás Silva"
                />
              </div>
            </div>

            <div class="modal-body im-body">
              <p>
                Clases dinámicas que combinan rendimiento y control, ideales
                para grupo.
              </p>
              <ul class="text-muted small">
                <li>Certificaciones: HIIT, Funcional</li>
                <li>Modalidades: Grupales · Rendimiento</li>
                <li>Enfoque: coordinación, resistencia</li>
              </ul>
              <a
                class="btn btn-gradient w-100"
                href="{% url 'index:clases' %}?instructor=Tomás%20Silva"
                ><i class="bi bi-calendar-event me-1"></i> Ver horarios</a
              >
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Ubicación -->
    <section class="container my-5 lp-reveal">
      <div
        class="p-4 p-md-5 rounded-4 text-white"
        style="background: linear-gradient(90deg,var(--lp-accent-1),var(--lp-accent-2));"
      >
        <div class="row align-items-center">
          <div class="col-12 col-md-8">
            <h4 class="fw-bold mb-2">Estamos en Peñalolén · Santiago</h4>
            <p class="mb-0">
              Av. Consistorial 2810. Estudio cómodo, implementos higienizados y
              estacionamiento en el edificio.
            </p>
          </div>
          <div class="col-12 col-md-4 text-md-end mt-3 mt-md-0">
            <a
              href="https://maps.app.goo.gl/Ytz1CZTw9wGq4Jwh7"
              class="btn btn-light text-dark fw-semibold"
            >
              <i class="bi bi-geo-alt-fill me-1"></i> Ver mapa
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Newsletter -->
    <section class="container my-5 lp-reveal">
      <div class="glass-soft p-4 p-md-5 rounded-4">
        <div class="row align-items-center g-3">
          <div class="col-12 col-md-6">
            <h5 class="fw-bold mb-1">Recibe tips de postura y promociones</h5>
            <div class="text-muted">Prometemos enviarte solo cosas útiles ✉️</div>
          </div>
          <div class="col-12 col-md-6">
            <form class="d-flex gap-2">
              <input
                type="email"
                class="form-control"
                placeholder="tu@email.com"
                required
              />
              <button class="btn btn-gradient" type="button">
                Suscribirme
              </button>
            </form>
          </div>
        </div>
      </div>
    </section>

    {% endif %}
    <!-- ======== /BLOQUES EXTRA HOME ======== -->

    <!-- ============== FOOTER (mejorado con redes) ============== -->
    <footer class="footer-neo text-white mt-auto">
      <div class="hr-accent"></div>

      <div class="container py-5">
        <div class="row g-4 align-items-start">
          <!-- Brand + Social -->
          <div class="col-12 col-lg-4">
            <div class="d-flex align-items-center gap-2 mb-2">
              <img
                src="https://cdn-icons-png.flaticon.com/512/1048/1048953.png"
                alt="Logo"
                width="36"
                height="36"
                class="rounded-circle border border-light p-1 logo-badge-bg"
              />
              <h5 class="m-0 fw-bold footer-title">Pilates Reforma</h5>
            </div>
            <p class="opacity-75 small mb-3">
              Clases Mat, Reformer y grupales con instructores certificados en
              Peñalolén, Santiago.
            </p>

            <div class="footer-social d-flex align-items-center gap-2">
              <a
                class="btn-icon"
                href="https://wa.me/56912345678"
                target="_blank"
                rel="noopener"
                aria-label="WhatsApp"
              >
                <i class="bi bi-whatsapp"></i>
              </a>
              <a
                class="btn-icon"
                href="https://instagram.com"
                target="_blank"
                rel="noopener"
                aria-label="Instagram"
              >
                <i class="bi bi-instagram"></i>
              </a>
              <a
                class="btn-icon"
                href="https://facebook.com"
                target="_blank"
                rel="noopener"
                aria-label="Facebook"
              >
                <i class="bi bi-facebook"></i>
              </a>
              <a
                class="btn-icon"
                href="https://tiktok.com"
                target="_blank"
                rel="noopener"
                aria-label="TikTok"
              >
                <i class="bi bi-tiktok"></i>
              </a>
              <a
                class="btn-icon"
                href="https://youtube.com"
                target="_blank"
                rel="noopener"
                aria-label="YouTube"
              >
                <i class="bi bi-youtube"></i>
              </a>
            </div>
          </div>

          <!-- Navegación -->
          <div class="col-6 col-lg-2">
            <h6 class="fw-semibold footer-title">Navegación</h6>
            <ul class="list-unstyled small m-0 footer-list">
              <li>
                <a
                  class="text-decoration-none text-white footer-link d-inline-flex align-items-center gap-2"
                  href="{% url 'index:index' %}"
                  ><i class="bi bi-house-door"></i>Inicio</a
                >
              </li>
              <li>
                <a
                  class="text-decoration-none text-white footer-link d-inline-flex align-items-center gap-2"
                  href="{% url 'index:clases' %}"
                  ><i class="bi bi-grid-3x3-gap"></i>Clases</a
                >
              </li>
              <li>
                <a
                  class="text-decoration-none text-white footer-link d-inline-flex align-items-center gap-2"
                  href="{% url 'index:contacto_publico' %}"
                  ><i class="bi bi-chat-dots"></i>Contacto</a
                >
              </li>
              <li>
                <a
                  class="text-decoration-none text-white footer-link d-inline-flex align-items-center gap-2"
                  href="{% url 'login:login' %}"
                  ><i class="bi bi-box-arrow-in-right"></i>Login</a
                >
              </li>
            </ul>
          </div>

          <!-- Contacto -->
          <div class="col-6 col-lg-3">
            <h6 class="fw-semibold footer-title">Contacto</h6>
            <ul class="list-unstyled small m-0 footer-list">
              <li class="mb-1 d-flex align-items-start gap-2">
                <i class="bi bi-geo-alt mt-1"></i
                ><span>Av. Consistorial 2810, Peñalolén</span>
              </li>
              <li class="mb-1 d-flex align-items-start gap-2">
                <i class="bi bi-telephone mt-1"></i
                ><a
                  class="text-white text-decoration-none footer-link"
                  href="tel:+56912345678"
                  >+56 9 1234 5678</a
                >
              </li>
              <li class="d-flex align-items-start gap-2">
                <i class="bi bi-envelope mt-1"></i
                ><a
                  class="text-white text-decoration-none footer-link"
                  href="mailto:contacto@pilatesreserva.cl"
                  >contacto@pilatesreserva.cl</a
                >
              </li>
            </ul>
          </div>

          <!-- Horarios -->
          <div class="col-12 col-lg-3">
            <h6 class="fw-semibold footer-title">Horarios</h6>
            <ul class="list-unstyled small m-0 opacity-75 footer-list">
              <li class="d-flex align-items-center gap-2">
                <i class="bi bi-clock"></i>Lun–Vie: 07:00–21:00
              </li>
              <li class="d-flex align-items-center gap-2">
                <i class="bi bi-clock"></i>Sábados: 09:00–14:00
              </li>
              <li class="d-flex align-items-center gap-2">
                <i class="bi bi-calendar-x"></i>Domingos y festivos: Cerrado
              </li>
            </ul>
          </div>
        </div>

        <hr class="footer-divider my-4" />

        <div
          class="d-flex flex-wrap justify-content-between align-items-center small"
        >
          <div class="opacity-75">
            © <span id="year"></span> Pilates Reforma. Todos los derechos
            reservados.
          </div>
          <div class="d-flex gap-3">
            <a class="footer-link text-white text-decoration-none" href="#"
              >Términos</a
            >
            <a class="footer-link text-white text-decoration-none" href="#"
              >Privacidad</a
            >
            <a
              class="footer-link text-white text-decoration-none"
              href="{% url 'index:contacto_publico' %}"
              >Soporte</a
            >
          </div>
        </div>
      </div>

      <!-- Botón volver arriba -->
      <button
        type="button"
        aria-label="Volver arriba"
        class="btn btn-light border-0 shadow position-fixed btn-to-top"
        onclick="window.scrollTo({top:0, behavior:'smooth'})"
      >
        <i class="bi bi-arrow-up"></i>
      </button>

      <script>
        (function () {
          const y = document.getElementById("year");
          if (y) y.textContent = new Date().getFullYear();
        })();
      </script>
    </footer>
    <!-- ============ /FOOTER ============ -->

    <!-- ===================== CHATBOT WIDGET ===================== -->
    <button id="chatFab" title="Chatear" aria-label="Abrir chat">
      <span class="iconify" data-icon="teenyicons:robot-solid"></span>
    </button>
    <div id="chatBox" role="dialog" aria-label="Asistente Pilates">
      <header>
        <div>
          <div class="fw-semibold">Asistente Pilates</div>
          <small class="opacity-75">Estoy para ayudarte ✨</small>
        </div>
        <button class="btn btn-sm btn-light" id="chatClose" aria-label="Cerrar">
          <i class="bi bi-x"></i>
        </button>
      </header>
      <div id="chatMsgs"></div>
      <form id="chatForm" autocomplete="off">
        <input id="chatInput" type="text" placeholder="Escribe tu mensaje..." />
        <button id="chatSend" type="submit">
          <i class="bi bi-send"></i> Enviar
        </button>
      </form>
    </div>

    <!-- === Template con el NUEVO contenido del card del header === -->
    <template id="hero-replacement">
      <div class="pr-hero-card">
        <span class="chip small mb-2 d-inline-flex align-items-center gap-1">
          <i class="bi bi-star-fill text-warning"></i> 4.9/5 por nuestros
          alumnos
        </span>

        <h1 class="display-5 fw-bold mt-2">
          Encuentra tu equilibrio con
          <span class="grad-text">Pilates Reforma</span>
        </h1>

        <p class="lead text-muted mb-4">
          Reserva clases <strong>Mat</strong>, <strong>Reformer</strong> y
          <strong>grupales</strong> con instructores certificados. Diseñado para
          todos los niveles.
        </p>

        <div class="d-flex flex-wrap gap-2">
          <a href="{% url 'index:clases' %}" class="btn btn-gradient btn-lg">
            <i class="bi bi-calendar-check me-1"></i> Reservar ahora
          </a>
          <a
            href="{% url 'index:contacto_publico' %}"
            class="btn btn-outline-secondary btn-lg"
          >
            <i class="bi bi-whatsapp me-1"></i> Hablar con nosotros
          </a>
        </div>

        <div class="d-flex flex-wrap gap-3 mt-3">
          <span class="chip"
            ><i class="bi bi-shield-check me-1"></i> Instructores
            certificados</span
          >
          <span class="chip"
            ><i class="bi bi-clock-history me-1"></i> Reserva en 1 minuto</span
          >
          <span class="chip"
            ><i class="bi bi-heart-pulse me-1"></i> Postura y bienestar</span
          >
        </div>
      </div>
    </template>

    <!-- JS del chat -->
    <script>
      (function () {
        const ENDPOINT = "{% url 'index:chat_api' %}";
        const box = document.getElementById("chatBox");
        const fab = document.getElementById("chatFab");
        const closeBtn = document.getElementById("chatClose");
        const msgs = document.getElementById("chatMsgs");
        const form = document.getElementById("chatForm");
        const input = document.getElementById("chatInput");
        const STORAGE_KEY = "pr-chat-history";

        function esc(s) {
          return (s || "").replace(/[&<>"']/g, (ch) => {
            return {
              "&": "&amp;",
              "<": "&lt;",
              ">": "&gt;",
              '"': "&quot;",
              "'": "&#39;",
            }[ch];
          });
        }
        function linkify(text) {
          const urlRe = /(https?:\/\/[^\s<>"']+)/g;
          return text.replace(
            urlRe,
            (u) =>
              `<a href="${u}" target="_blank" rel="noopener noreferrer">${u}</a>`
          );
        }
        function toHtml(text) {
          return linkify(esc(text).replace(/\n/g, "<br>"));
        }
        function getCSRF() {
          const n = document.querySelector(
            '#csrf-token input[name=csrfmiddlewaretoken]'
          );
          if (n && n.value) return n.value;
          const m = document.cookie.match(
            /(^|;)\s*csrftoken=([^;]+)/
          );
          return m ? decodeURIComponent(m[2]) : "";
        }
        function saveHistory() {
          try {
            const data = [...msgs.querySelectorAll(".bubble")].map((b) => ({
              t: b.classList.contains("me-bubble") ? "me" : "bot",
              m: b.innerText,
            }));
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
          } catch (e) {}
        }
        function loadHistory() {
          try {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (!raw) return;
            JSON.parse(raw).forEach((o) => appendBubble(o.m, o.t === "me"));
            scrollToBottom();
          } catch (e) {}
        }
        function appendBubble(text, isMe) {
          const div = document.createElement("div");
          div.className = "bubble " + (isMe ? "me-bubble" : "bot-bubble");
          div.innerHTML = toHtml(text);
          msgs.appendChild(div);
          saveHistory();
        }
        function scrollToBottom() {
          msgs.scrollTop = msgs.scrollHeight;
        }
        function toggle(open) {
          box.style.display = open ? "block" : "none";
          if (open) {
            setTimeout(() => input.focus(), 100);
          }
        }

        fab.addEventListener("click", () => toggle(true));
        closeBtn.addEventListener("click", () => toggle(false));

        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          const text = (input.value || "").trim();
          if (!text) return;
          appendBubble(text, true);
          input.value = "";
          scrollToBottom();

          const wait = document.createElement("div");
          wait.className = "bubble bot-bubble";
          wait.textContent = "…";
          msgs.appendChild(wait);
          scrollToBottom();

          try {
            const res = await fetch(ENDPOINT, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": getCSRF(),
              },
              body: JSON.stringify({ message: text }),
            });
            msgs.removeChild(wait);
            if (res.ok) {
              const data = await res.json();
              appendBubble(data.reply || "Gracias por tu mensaje.", false);
            } else {
              appendBubble(
                "Lo siento, no pude responder ahora. Intenta más tarde.",
                false
              );
            }
          } catch {
            try {
              msgs.removeChild(wait);
            } catch {}
            appendBubble(
              "Hubo un problema de conexión. Intenta nuevamente.",
              false
            );
          }
          scrollToBottom();
        });

        input.addEventListener("keydown", (e) => {
          if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            form.requestSubmit();
          }
        });

        loadHistory();
        if (!msgs.children.length) {
          appendBubble(
            "¡Hola! Soy tu asistente de Pilates 🤸‍♀️\nPregúntame por horarios, precios, ubicación o cómo reservar.",
            false
          );
        }
      })();
    </script>

    <!-- UPGRADE JS: tema, reveal, CTA, y REEMPLAZO del card del header -->
    <script>
      (() => {
        // THEME
        const root = document.documentElement,
          KEY = "pr-theme";
        function setIcon(t) {
          const i = document.getElementById("themeIcon");
          if (!i) return;
          i.className = t === "dark" ? "bi bi-sun" : "bi bi-moon-stars";
        }
        function apply(t) {
          root.setAttribute("data-theme", t);
          setIcon(t);
        }
        let saved = null;
        try {
          saved = localStorage.getItem(KEY);
        } catch (e) {}
        const initial =
          saved ||
          (window.matchMedia &&
          window.matchMedia("(prefers-color-scheme: dark)").matches
            ? "dark"
            : "light");
        apply(initial);
        const btn = document.getElementById("themeToggle");
        if (btn) {
          btn.addEventListener("click", () => {
            const next =
              root.getAttribute("data-theme") === "dark" ? "light" : "dark";
            apply(next);
            try {
              localStorage.setItem(KEY, next);
            } catch (e) {}
          });
        }

        // REVEAL
        const io = new IntersectionObserver(
          (entries) => {
            entries.forEach((e) =>
              e.target.classList.toggle("is-in", e.isIntersecting)
            );
          },
          { threshold: 0.14 }
        );
        document
          .querySelectorAll(".lp-reveal")
          .forEach((el) => io.observe(el));

        // Sticky CTA
        const isHome =
          "{{ request.resolver_match.url_name|default:'' }}" === "index";
        if (isHome) {
          const cta = document.createElement("div");
          cta.className = "lp-sticky-cta";
          cta.innerHTML = `<span class="small d-none d-sm-inline">¿Listo para comenzar?</span>
        <a href="{% url 'index:clases' %}" class="btn btn-gradient"><i class="bi bi-calendar-check me-1"></i> Reservar</a>
        <a href="{% url 'index:contacto_publico' %}" class="btn btn-outline-secondary"><i class="bi bi-chat-dots me-1"></i> Consultar</a>`;
          document.body.appendChild(cta);
          let shown = false;
          window.addEventListener(
            "scroll",
            () => {
              const y = window.scrollY || document.documentElement.scrollTop;
              const should = y > 600;
              if (should && !shown) {
                cta.style.display = "flex";
                shown = true;
              }
              if (!should && shown) {
                cta.style.display = "none";
                shown = false;
              }
            },
            { passive: true }
          );
        }

        // ===== Reemplazar solo el CONTENIDO del card del header original =====
        if ("{{ request.resolver_match.url_name|default:'' }}" === "index") {
          const tpl = document.getElementById("hero-replacement");
          const oldH = [...document.querySelectorAll("h1,h2")].find((h) =>
            /transforma tu cuerpo con pilates/i.test(h.textContent || "")
          );
          if (tpl && oldH) {
            let card =
              oldH.closest(
                ".glass, .card, .rounded-4, .rounded-3, .rounded, .p-4, .p-5"
              ) || oldH.parentElement;
            if (card) {
              card.classList.add("pr-hero-card");
              card.innerHTML = tpl.innerHTML;

              // >>> Nuevo: marca el CONTENEDOR del hero para apagar sus ::before/::after
              const rootWrap =
                card.closest(
                  "section, header, main, div, .container, .container-fluid"
                ) || card.parentElement;
              if (rootWrap) rootWrap.classList.add("pr-hero-root");
            }
          }
        }
      })();
    </script>

    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
