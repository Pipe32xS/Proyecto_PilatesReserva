{# Espera variables en contexto:
   obj (ClasePilates), reservados (opcional), libres (opcional),
   reservas_por_clase (opcional dict), reserve_url_name (opcional)
#}
{% with r=reservados %}
  {% if r == None %}
    {% if obj.reservas_count %}
      {% with r=obj.reservas_count %}{% endwith %}
    {% elif reservas_por_clase %}
      {% with r=reservas_por_clase|get_item:obj.id %}{% endwith %}
    {% else %}
      {% with r=0 %}{% endwith %}
    {% endif %}
  {% endif %}

  <div class="col-12 col-sm-6 col-lg-4">
    <div class="card h-100 shadow-sm">
      <div class="card-body d-flex flex-column">
        <h5 class="card-title mb-1">{{ obj.nombre_clase }}</h5>

        <div class="small text-muted mb-2">
          {{ obj.fecha|date:"M j, Y" }} â€” {{ obj.horario|time:"H:i" }}
        </div>

        <div class="mb-2">
          <span class="badge rounded-pill badge-free">
            Cupos: {{ obj.capacidad_maxima }}{% if r != None %} | Reservados: {{ r }}{% endif %}
          </span>
        </div>

        {% if obj.nombre_instructor %}
          <div class="small mb-2"><strong>Instructor:</strong> {{ obj.nombre_instructor }}</div>
        {% endif %}

        {% if obj.descripcion %}
          <p class="text-muted text-truncate-2 mb-3">{{ obj.descripcion }}</p>
        {% else %}
          <div class="mb-3"></div>
        {% endif %}

        <div class="mt-auto d-grid">
          {% if reserve_url_name %}
            <a class="btn btn-primary" href="{% url reserve_url_name obj.id %}">Reservar</a>
          {% else %}
            <a class="btn btn-primary" href="#">Reservar</a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
{% endwith %}
