{% extends "administrador/base_admin.html" %}

{% block encabezado %}Gestión de horarios{% endblock %}

{% block content %}

<style>
  /* Estética consistente con el resto del panel */
  .hero-gradient{background:linear-gradient(90deg,#4f46e5 0%,#2563eb 40%,#0ea5e9 100%)}
  .table-card{border:1px solid #e5e7eb;border-radius:1rem;overflow:hidden;background:#fff;box-shadow:0 12px 30px rgba(2,6,23,.06)}
  .table thead th{font-weight:700;color:#334155;background:#f8fafc;border-bottom:1px solid #e2e8f0}
  .badge-soft{background:#ecfeff;color:#0ea5e9;border:1px solid rgba(14,165,233,.2)}
  .badge-soft-amber{background:#fff7ed;color:#c2410c;border:1px solid rgba(234,88,12,.18)}
  .badge-soft-indigo{background:#eef2ff;color:#4f46e5;border:1px solid rgba(79,70,229,.2)}
  .badge-active{background:#ecfdf5;color:#059669;border:1px solid rgba(5,150,105,.18)}
  .badge-inactive{background:#f8fafc;color:#475569;border:1px solid #e2e8f0}
  .toolbar .form-select,.toolbar .form-control{box-shadow:none}
  .empty-wrap{border:1px dashed #cbd5e1;border-radius:1rem;background:#f8fafc}
</style>

<!-- ====== HERO ====== -->
<section class="rounded-4 hero-gradient text-white p-4 p-md-5 mb-4">
  <div class="d-flex flex-column flex-lg-row align-items-start align-items-lg-center justify-content-between gap-3">
    <div>
      <span class="badge text-bg-light text-primary fw-semibold mb-2">
        <i class="bi bi-clock-history me-1"></i> Planificación
      </span>
      <h1 class="h3 fw-bold mb-1">Gestión de horarios</h1>
      <p class="mb-0 opacity-75">
        Define bloques por día, instructor y capacidad.
        <span class="d-inline-flex align-items-center ms-2">
          <i class="bi bi-collection me-1"></i> Horarios:
          <strong>{% if bloques %}{{ bloques|length }}{% else %}0{% endif %}</strong>
        </span>
      </p>
    </div>
    <div class="d-flex flex-wrap gap-2">
      <a class="btn btn-light text-primary fw-semibold" href="{% url 'administrador:horario_crear' %}">
        <i class="bi bi-plus-lg me-1"></i> Nuevo bloque
      </a>
      <a href="{% url 'administrador:horarios_generar_clases' %}" class="btn btn-outline-light fw-semibold">
        <i class="bi bi-magic me-1"></i> Generar clases
      </a>
      <a class="btn btn-outline-light" href="{% url 'administrador:home' %}">
        <i class="bi bi-arrow-left me-1"></i> Volver
      </a>
    </div>
  </div>
</section>

<!-- ====== FILTROS / TOOLBAR ====== -->
<div class="rounded-4 shadow-sm p-3 p-md-4 bg-white mb-3 toolbar">
  <form method="get" class="row g-2 align-items-center">
    <div class="col-12 col-lg-4">
      <div class="input-group">
        <span class="input-group-text"><i class="bi bi-search"></i></span>
        <input type="text" class="form-control" name="q" placeholder="Buscar por instructor…" value="{{ q }}">
      </div>
    </div>

    <div class="col-6 col-lg-4">
      <select class="form-select" name="dia">
        <option value="">Todos los días</option>
        <option value="0" {% if dia == "0" %}selected{% endif %}>Lunes</option>
        <option value="1" {% if dia == "1" %}selected{% endif %}>Martes</option>
        <option value="2" {% if dia == "2" %}selected{% endif %}>Miércoles</option>
        <option value="3" {% if dia == "3" %}selected{% endif %}>Jueves</option>
        <option value="4" {% if dia == "4" %}selected{% endif %}>Viernes</option>
        <option value="5" {% if dia == "5" %}selected{% endif %}>Sábado</option>
        <option value="6" {% if dia == "6" %}selected{% endif %}>Domingo</option>
      </select>
    </div>

    <div class="col-6 col-lg-3">
      <select class="form-select" name="activos">
        <option value="todos" {% if activos == "todos" %}selected{% endif %}>Todos</option>
        <option value="solo_activos" {% if activos == "solo_activos" %}selected{% endif %}>Solo activos</option>
        <option value="solo_inactivos" {% if activos == "solo_inactivos" %}selected{% endif %}>Solo inactivos</option>
      </select>
    </div>

    <div class="col-12 col-lg-1 d-grid">
      <button class="btn btn-primary"><i class="bi bi-funnel me-1"></i> Filtrar</button>
    </div>
  </form>
</div>

{% if bloques and bloques|length > 0 %}

  <!-- ====== TABLA ====== -->
  <div class="table-card">
    <div class="table-responsive">
      <table class="table align-middle mb-0">
        <thead>
          <tr>
            <th style="width:10rem;">Día</th>
            <th style="width:7rem;">Inicio</th>
            <th style="width:7rem;">Fin</th>
            <th>Instructor</th>
            <th class="text-center" style="width:7rem;">Capacidad</th>
            <th class="text-center" style="width:7rem;">Estado</th>
            <th class="text-end" style="width:12rem;">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for b in bloques %}
          <tr>
            <td class="fw-semibold">
              {% if b.dia_semana == 5 or b.dia_semana == 6 %}
                <span class="badge rounded-pill badge-soft-amber">
                  <i class="bi bi-calendar-event me-1"></i>
                  {% if b.dia_semana == 5 %}Sábado{% else %}Domingo{% endif %}
                </span>
              {% else %}
                <span class="badge rounded-pill badge-soft">
                  <i class="bi bi-calendar-week me-1"></i>
                  {% if b.dia_semana == 0 %}Lunes{% elif b.dia_semana == 1 %}Martes{% elif b.dia_semana == 2 %}Miércoles
                  {% elif b.dia_semana == 3 %}Jueves{% elif b.dia_semana == 4 %}Viernes{% else %}—{% endif %}
                </span>
              {% endif %}
            </td>

            <td><span class="badge rounded-pill text-bg-light border"><i class="bi bi-alarm me-1"></i>{{ b.hora_inicio|time:"H:i" }}</span></td>
            <td><span class="badge rounded-pill text-bg-light border"><i class="bi bi-alarm me-1"></i>{{ b.hora_fin|time:"H:i" }}</span></td>

            <td>
              <div class="d-flex align-items-center gap-2">
                <span class="rounded-circle d-inline-flex align-items-center justify-content-center text-white"
                      style="width:32px;height:32px;background:#2563eb;">
                  {{ b.instructor|default:"?"|slice:":1" }}
                </span>
                <div class="fw-semibold">{{ b.instructor|default:"—" }}</div>
              </div>
            </td>

            <td class="text-center">
              <span class="badge rounded-pill badge-soft-indigo">{{ b.capacidad }}</span>
            </td>

            <td class="text-center">
              {% if b.activo %}
                <span class="badge rounded-pill badge-active"><i class="bi bi-check2-circle me-1"></i>Activo</span>
              {% else %}
                <span class="badge rounded-pill badge-inactive"><i class="bi bi-slash-circle me-1"></i>Inactivo</span>
              {% endif %}
            </td>

            <td class="text-end">
              <div class="btn-group btn-group-sm">
                <a class="btn btn-outline-primary" href="{% url 'administrador:horario_editar' b.id %}">
                  <i class="bi bi-pencil-square me-1"></i> Editar
                </a>
                <a class="btn btn-outline-danger" href="{% url 'administrador:horario_eliminar' b.id %}"
                   onclick="return confirm('¿Seguro que deseas eliminar este bloque?')">
                  <i class="bi bi-trash3 me-1"></i> Eliminar
                </a>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

{% else %}

  <!-- ====== EMPTY STATE ====== -->
  <div class="empty-wrap p-5 text-center">
    <div class="display-6 mb-2 text-primary"><i class="bi bi-calendar2-week"></i></div>
    <h5 class="fw-semibold mb-1">Sin bloques aún</h5>
    <p class="text-secondary mb-3">Crea tus primeros horarios para comenzar a generar clases.</p>
    <a class="btn btn-primary" href="{% url 'administrador:horario_crear' %}">
      <i class="bi bi-plus-lg me-1"></i> Nuevo bloque
    </a>
  </div>

{% endif %}

{% endblock %}
